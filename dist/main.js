(()=>{window.Webflow||(window.Webflow=[]);window.Webflow.push(async()=>{let v={"#First-Name":A,"#Last-Name":A,"#Street-Address":h,"#City":h,"#State-of-residence":S,"#ZIP-Code":h,"#Income-Amount":q,"#DOB":I,"#Phone-Number":C,'[form-field="dropdown"]':S,"input[required]":D};function b(e,t){let o=t(e),n=e.closest(".form-field_item").querySelector('[data-text="error-message"]');return o?n.style.display="none":n.style.display="block",o}function E(e){if(e.querySelector(".radar-field"))return console.log("Validating address step"),k(e);let t=e.querySelectorAll(".form-field"),o=e.querySelectorAll('input[type="radio"]'),n=!0;return t.forEach(r=>{let i=w(r);i&&!b(r,i)&&(n=!1)}),o.length>0&&!F(o)&&(n=!1),n}function k(e){let t=e.querySelectorAll(".form-field"),o=!0;return y||(o=!1),t.forEach(n=>{n.value.trim()===""&&(o=!1)}),t.forEach(n=>{let r=w(n);r&&!b(n,r)&&(o=!1)}),o}let Y={"/thank-you-debtcom":["Alaska","Alabama","Arkansas","Arizona","California","District of Columbia","Florida","Indiana","Massachusetts","Maryland","Michigan","Missouri","Mississippi","North Carolina","Nebraska","New Mexico","New York","Oklahoma","South Dakota","Texas","Washington","Wisconsin"]};function w(e){for(let t in v)if(e.matches(t))return v[t];return null}function D(e){return e.value.trim()!==""}function S(e){let t=e.options[0].value;return e.value!==t}function A(e){let t=e.value.trim();return/^[A-Za-z]{3,}$/.test(t)}function h(e){return!0}function q(e){let t=e.value.trim().replace(/,/g,"");return/^\d{4,}$/.test(t)}function C(e){return e.value.trim().replace(/[\(\)-\s]/g,"").length===10}function F(e){let t=!1;return e.forEach(o=>{o.checked&&(t=!0)}),t}function I(e){let t=e.value.trim().replace(/\D/g,"");if(t.length!==8)return!1;let o=parseInt(t.slice(0,2),10),n=parseInt(t.slice(2,4),10),r=parseInt(t.slice(4),10);if(isNaN(o)||isNaN(n)||isNaN(r)||o<1||o>12||n<1||n>31)return!1;let i=new Date(r,o-1,n),l=new Date-i,s=new Date(l);return Math.abs(s.getUTCFullYear()-1970)>=18}function x(e){let t=e.querySelector('[data-button="next"]'),o=E(e);t&&(t.style.pointerEvents="none",o?(B(t),t.classList.add("is-active")):(_(t),t.classList.remove("is-active")))}function B(e){e&&(e.classList.remove("disabled"),e.style.pointerEvents="auto",e.style.opacity="1")}function _(e){e&&(e.classList.add("disabled"),e.style.pointerEvents="none",e.style.opacity="0.5")}let c=document.querySelectorAll('[data-form="step"]');c.forEach(e=>{e.style.display="none"});function f(e,t){let o=(e-1)/(t-1)*100,n=document.querySelector(".progress-line");n.style.width=o+"%"}let P=document.querySelectorAll('[data-form="step"]').length;f(1,P);let O=c[0];O.style.display="flex";let p=document.getElementById("hero-form");p.addEventListener("submit",async e=>{e.preventDefault();function t(r){return`+1${(""+r).replace(/\D/g,"").substring(0,10)}`}function o(r){let[i,a,l]=r.split("-");return`${l}-${i}-${a}`}let n={first_name:document.getElementById("First-Name").value||"",last_name:document.getElementById("Last-Name").value||"",email:document.getElementById("Email")&&document.getElementById("Email").value||"",phone:document.getElementById("Phone-Number")?t(document.getElementById("Phone-Number").value||""):"",dob:o(document.getElementById("DOB").value||""),address:{street:document.getElementById("Street-Address").value||"",city:document.getElementById("City").value||"",state:document.getElementById("State-of-residence").value||"",zipcode:document.getElementById("ZIP-Code").value||""},website:window.location.origin||""};console.log("Submitting form data:",n);try{let r=await fetch("https://credit-api.netlify.app/.netlify/functions/credit-api",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}),i=await r.json();if(!r.ok)throw new Error(i.error||"API request failed");let{result:a,zapierResult:l,error:s}=i;console.log("Credit API response:",a),console.log("Zapier response:",l),s&&console.error("Credit API error:",s),document.getElementById("balance_unsecured_accounts").value=a?.balance_unsecured_accounts?.max?.toString()||"",document.getElementById("balance_unsecured_credit_cards").value=a?.balance_unsecured_credit_cards?.max?.toString()||"",document.getElementById("creditScore").value=a?.creditScore?.max?.toString()||"";let d={event:"creditFormSubmission",balance_unsecured_accounts:a?.balance_unsecured_accounts?.max||"N/A",balance_unsecured_credit_cards:a?.balance_unsecured_credit_cards?.max||"N/A",creditScore:a?.creditScore?.max||"N/A",formData:n,api_error:s||"N/A",zapier_error:l.error||"N/A"};window.dataLayer?window.dataLayer.push(d):console.warn("Google Tag Manager dataLayer not found");let u=p.getAttribute("redirect-url-high"),g=p.getAttribute("redirect-url-low"),m,H=9999,N=a?.balance_unsecured_credit_cards?.max;typeof N=="number"&&N>H?(m=u,window.dataLayer&&window.dataLayer.push({event:"custom_conversion",event_category:"engagement",event_label:"High Unsecured Credit Card Balance"})):(m=g,window.dataLayer&&window.dataLayer.push({event:"custom_conversion",event_category:"engagement",event_label:"Low Unsecured Credit Card Balance"})),L(m||g)}catch(r){console.error("Error:",r),window.dataLayer&&window.dataLayer.push({event:"creditFormSubmission",error:r.message,formData:n});let i=p.getAttribute("redirect-url-low");L(i)}});function L(e){e?e.startsWith("http://")||e.startsWith("https://")?window.location.href=e:window.location.href=`${window.location.origin}${e.startsWith("/")?"":"/"}${e}`:console.error("No redirect URL specified")}c.forEach(e=>{if(e.querySelectorAll(".form-field").forEach(i=>{i.addEventListener("input",()=>{x(e)}),i.addEventListener("change",()=>{x(e)})}),e.hasAttribute("data-radio-step")){let i=e.querySelectorAll('input[type="radio"]:not([data-link-out])'),a=e.querySelector('[data-button="next"]');a&&(a.style.display="none"),i.forEach(l=>{l.addEventListener("click",()=>{let s=e.querySelector('[data-button="next"]');if(s){s.click();let d=Array.from(c).indexOf(e)+2,u=c.length;f(d,u)}})})}let o=e.querySelector('[data-button="next"]');o&&o.addEventListener("click",async i=>{if(e.hasAttribute("data-step")&&e.getAttribute("data-step")==="income"){let a=e.querySelector("[data-income]");if(a&&parseFloat(a.value.replace(/,/g,""))<1e4){let s=a.getAttribute("data-income-link");window.location.href=s;return}}if(e.hasAttribute("data-twilio")){i.preventDefault();let a=document.getElementById("Phone-Number").value;console.log("Validating phone number:",a);try{let s=await(await fetch(`https://credit-api.netlify.app/.netlify/functions/validate-phone?phoneNumber=${encodeURIComponent(a)}`)).json();if(console.log("Response data:",s),s.valid){console.log("The phone number is a valid mobile number.");let d=e,u=d.nextElementSibling;u&&u.matches('[data-form="step"]')&&(d.style.display="none",u.style.display="flex");let g=Array.from(c).indexOf(e)+1,m=c.length;f(g,m)}else console.warn("The phone number is not a valid mobile number or an error occurred."),alert("Please enter a valid mobile phone number.")}catch(l){console.error("Error during fetch:",l),alert("An error occurred while validating the phone number.")}}else if(E(e)){let l=e,s=l.nextElementSibling;s&&s.matches('[data-form="step"]')&&(l.style.display="none",s.style.display="flex");let d=Array.from(c).indexOf(e)+1,u=c.length;f(d,u)}else i.preventDefault(),console.log("Validation failed. Please fill in all required fields.")});let n=e.querySelector('[data-form="back-btn"]');Array.from(c).indexOf(e)===0?n&&(n.style.display="none"):n&&(n.style.display="flex"),n&&n.addEventListener("click",()=>{let i=e,a=i.previousElementSibling;a&&a.matches('[data-form="step"]')&&(i.style.display="none",a.style.display="flex");let l=Array.from(c).indexOf(a)+1,s=c.length;f(l,s)})});function $(e){e.preventDefault();let t=e.target.dataset.linkOut;window.location.href=t}document.querySelectorAll("[data-link-out]").forEach(e=>{e.dataset.linkOut&&e.addEventListener("click",$)});let V=document.getElementById("Income-Amount");function M(e){return e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}function R(e){let t=e.target.value.replace(/,/g,""),o=M(t);e.target.value=o}V.addEventListener("input",R);function T(e){return e=e.replace(/\D/g,""),e=e.substring(0,10),e.length>=6?e.replace(/(\d{3})(\d{3})(\d{1,4})/,"($1)-$2-$3"):e.length>=3?e.replace(/(\d{3})(\d{1,3})/,"($1)-$2"):e}function W(e){e.target.value=T(e.target.value)}document.querySelectorAll("[data-phone]").forEach(e=>{e.addEventListener("input",W)});function Z(e){return e=e.replace(/\D/g,""),e.length>8&&(e=e.slice(0,8)),e.length>2&&(e=e.slice(0,2)+"-"+e.slice(2)),e.length>5&&(e=e.slice(0,5)+"-"+e.slice(5,9)),e}function z(e){let t=Z(e.target.value);e.target.value=t;let o=I(e.target),n=e.target.closest(".form-field_item").querySelector('[data-text="error-message"]');o?n.style.display="none":n.style.display="block"}document.getElementById("DOB").addEventListener("input",z);let y=!1;Radar.initialize("prj_live_pk_9a04f6bab292b47ffdad877f7bd7d63fa6d2bc54");function j(){let e=document.getElementById("Street-Address"),t=document.getElementById("City"),o=document.getElementById("State-of-residence"),n=document.getElementById("ZIP-Code"),r=document.querySelector('[data-form="next-btn"]');document.getElementById("autocomplete-container")&&Radar.ui.autocomplete({container:"Street-Address",responsive:!0,minCharacters:2,debounceMS:0,onSelection:a=>{U(a,e,t,o,n),B(r),y=!0;let l=document.querySelector("radar-autocomplete-wrapper");l&&(l.style.display="none",console.log("Autocomplete container hidden")),e.dispatchEvent(new Event("focusout"))}})}function U(e,t,o,n,r){t.value="",o.value="",n.value="",r.value="",e.number&&e.street?t.value=`${e.number} ${e.street}`:t.value="",o.value=e.city||"",n.value=e.state||"",r.value=e.postalCode||"",r.dispatchEvent(new Event("input"))}j(),document.querySelectorAll("#Street-Address, #City, #State-of-residence, #ZIP-Code").forEach(e=>{e.addEventListener("input",()=>{y=!0})}),document.querySelectorAll(".form-next_btn").forEach(e=>{e.addEventListener("click",t=>{y||(t.preventDefault(),_(e))})})});})();
