(()=>{window.Webflow||(window.Webflow=[]);window.Webflow.push(async()=>{let w={"#First-Name":I,"#Last-Name":I,"#Street-Address":y,"#City":y,"#State-of-residence":A,"#ZIP-Code":y,"#Income-Amount":D,"#DOB":x,"#Phone-Number":F,'[form-field="dropdown"]':A,"input[required]":C};function b(e,t){let n=t(e),o=e.closest(".form-field_item").querySelector('[data-text="error-message"]');return n?o.style.display="none":o.style.display="block",n}function S(e){if(e.querySelector(".radar-field"))return console.log("Validating address step"),k(e);let t=e.querySelectorAll(".form-field"),n=e.querySelectorAll('input[type="radio"]'),o=!0;return t.forEach(i=>{let a=E(i);a&&!b(i,a)&&(o=!1)}),n.length>0&&!P(n)&&(o=!1),o}function k(e){let t=e.querySelectorAll(".form-field"),n=!0;return p||(n=!1),t.forEach(o=>{o.value.trim()===""&&(n=!1)}),t.forEach(o=>{let i=E(o);i&&!b(o,i)&&(n=!1)}),n}let Q={"/thank-you-debtcom":["Alaska","Alabama","Arkansas","Arizona","California","District of Columbia","Florida","Indiana","Massachusetts","Maryland","Michigan","Missouri","Mississippi","North Carolina","Nebraska","New Mexico","New York","Oklahoma","South Dakota","Texas","Washington","Wisconsin"]};function E(e){for(let t in w)if(e.matches(t))return w[t];return null}function C(e){return e.value.trim()!==""}function A(e){let t=e.options[0].value;return e.value!==t}function I(e){let t=e.value.trim();return/^[A-Za-z]{3,}$/.test(t)}function y(e){return!0}function D(e){let t=e.value.trim().replace(/,/g,"");return/^\d{4,}$/.test(t)}function F(e){return e.value.trim().replace(/[\(\)-\s]/g,"").length===10}function P(e){let t=!1;return e.forEach(n=>{n.checked&&(t=!0)}),t}function x(e){let t=e.value.trim().replace(/\D/g,"");if(t.length!==8)return!1;let n=parseInt(t.slice(0,2),10),o=parseInt(t.slice(2,4),10),i=parseInt(t.slice(4),10);if(isNaN(n)||isNaN(o)||isNaN(i)||n<1||n>12||o<1||o>31)return!1;let a=new Date(i,n-1,o),r=new Date-a,c=new Date(r);return Math.abs(c.getUTCFullYear()-1970)>=18}function B(e){let t=e.querySelector('[data-button="next"]'),n=S(e);t&&(t.style.pointerEvents="none",n?(_(t),t.classList.add("is-active")):(q(t),t.classList.remove("is-active")))}function _(e){e&&(e.classList.remove("disabled"),e.style.pointerEvents="auto",e.style.opacity="1")}function q(e){e&&(e.classList.add("disabled"),e.style.pointerEvents="none",e.style.opacity="0.5")}let d=document.querySelectorAll('[data-form="step"]');d.forEach(e=>{e.style.display="none"});function f(e,t){let n=(e-1)/(t-1)*100,o=document.querySelector(".progress-line");o.style.width=n+"%"}let O=document.querySelectorAll('[data-form="step"]').length;f(1,O);let $=d[0];$.style.display="flex";function V(){let e={};return window.location.search.substring(1).split("&").forEach(o=>{let[i,a]=o.split("=");e[decodeURIComponent(i)]=decodeURIComponent(a||"")}),e}function R(e){Object.entries({utm_medium:"channeldrilldown1",utm_source:"channeldrilldown2",utm_campaign:"channeldrilldown3",utm_content:"channeldrilldown4",s4:"channeldrilldown5",pid:"channeldrilldown6"}).forEach(([n,o])=>{if(e.hasOwnProperty(n)){let i=document.querySelector(`input[name="${o}"]`);i&&(i.value=e[n])}})}let M=V();R(M);let m=document.getElementById("hero-form");m.addEventListener("submit",async e=>{e.preventDefault();function t(a,l){let r=document.getElementById(a);r?r.value=l:console.warn(`Hidden field '${a}' not found`)}function n(a){return`+1${(""+a).replace(/\D/g,"").substring(0,10)}`}function o(a){let[l,r,c]=a.split("-");return`${c}-${l}-${r}`}let i={first_name:document.getElementById("First-Name").value||"",last_name:document.getElementById("Last-Name").value||"",email:document.getElementById("Email")&&document.getElementById("Email").value||"",phone:document.getElementById("Phone-Number")?n(document.getElementById("Phone-Number").value||""):"",dob:o(document.getElementById("DOB").value||""),address:{street:document.getElementById("Street-Address").value||"",city:document.getElementById("City").value||"",state:document.getElementById("State-of-residence").value||"",zipcode:document.getElementById("ZIP-Code").value||""},website:window.location.origin||"",channeldrilldown1:document.querySelector('input[name="channeldrilldown1"]')?.value||"",channeldrilldown2:document.querySelector('input[name="channeldrilldown2"]')?.value||"",channeldrilldown3:document.querySelector('input[name="channeldrilldown3"]')?.value||"",channeldrilldown4:document.querySelector('input[name="channeldrilldown4"]')?.value||"",channeldrilldown5:document.querySelector('input[name="channeldrilldown5"]')?.value||"",channeldrilldown6:document.querySelector('input[name="channeldrilldown6"]')?.value||""};console.log("Submitting form data:",i);try{let a=await fetch("https://credit-api.netlify.app/.netlify/functions/credit-api",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)}),l=await a.json();if(!a.ok)throw new Error(l.error||"API request failed");let{result:r,zapierResult:c,error:u}=l;console.log("Credit API response:",r),console.log("Zapier response:",c),u&&console.error("Credit API error:",u),t("balance_unsecured_accounts",r?.balance_unsecured_accounts?.max?.toString()||""),t("balance_unsecured_credit_cards",r?.balance_unsecured_credit_cards?.max?.toString()||""),t("creditScore",r?.creditScore?.max?.toString()||"");let s=Number(r?.balance_unsecured_credit_cards?.max),h={event:"creditFormSubmission",balance_unsecured_accounts:r?.balance_unsecured_accounts?.max||"N/A",balance_unsecured_credit_cards:s||"N/A",creditScore:r?.creditScore?.max||"N/A",formData:i,api_error:u||"N/A",zapier_error:c.error||"N/A"};window.dataLayer?window.dataLayer.push(h):console.warn("Google Tag Manager dataLayer not found");let g=m.getAttribute("redirect-url-high"),L=m.getAttribute("redirect-url-low"),v;!isNaN(s)&&s>9999?(v=g,window.dataLayer&&window.dataLayer.push({event:"custom_conversion",event_category:"engagement",event_label:"High Unsecured Credit Card Balance",balance_unsecured_credit_cards:s})):(v=L,window.dataLayer&&window.dataLayer.push({event:"custom_conversion",event_category:"engagement",event_label:"Low Unsecured Credit Card Balance",balance_unsecured_credit_cards:s})),N(v||L)}catch(a){console.error("Error:",a),window.dataLayer&&window.dataLayer.push({event:"creditFormSubmission",error:a.message,formData:i});let l=m.getAttribute("redirect-url-low");N(l)}});function N(e){e?e.startsWith("http://")||e.startsWith("https://")?window.location.href=e:window.location.href=`${window.location.origin}${e.startsWith("/")?"":"/"}${e}`:console.error("No redirect URL specified")}d.forEach(e=>{if(e.querySelectorAll(".form-field").forEach(a=>{a.addEventListener("input",()=>{B(e)}),a.addEventListener("change",()=>{B(e)})}),e.hasAttribute("data-radio-step")){let a=e.querySelectorAll('input[type="radio"]:not([data-link-out])'),l=e.querySelector('[data-button="next"]');l&&(l.style.display="none"),a.forEach(r=>{r.addEventListener("click",()=>{let c=e.querySelector('[data-button="next"]');if(c){c.click();let u=Array.from(d).indexOf(e)+2,s=d.length;f(u,s)}})})}let n=e.querySelector('[data-button="next"]');n&&n.addEventListener("click",async a=>{if(e.hasAttribute("data-step")&&e.getAttribute("data-step")==="income"){let l=e.querySelector("[data-income]");if(l&&parseFloat(l.value.replace(/,/g,""))<1e4){let c=l.getAttribute("data-income-link");window.location.href=c;return}}if(e.hasAttribute("data-twilio")){a.preventDefault();let l=document.getElementById("Phone-Number").value;console.log("Validating phone number:",l);try{let c=await(await fetch(`https://credit-api.netlify.app/.netlify/functions/validate-phone?phoneNumber=${encodeURIComponent(l)}`)).json();if(console.log("Response data:",c),c.valid){console.log("The phone number is a valid mobile number.");let u=e,s=u.nextElementSibling;s&&s.matches('[data-form="step"]')&&(u.style.display="none",s.style.display="flex");let h=Array.from(d).indexOf(e)+1,g=d.length;f(h,g)}else console.warn("The phone number is not a valid mobile number or an error occurred."),alert("Please enter a valid mobile phone number.")}catch(r){console.error("Error during fetch:",r),alert("An error occurred while validating the phone number.")}}else if(S(e)){let r=e,c=r.nextElementSibling;c&&c.matches('[data-form="step"]')&&(r.style.display="none",c.style.display="flex");let u=Array.from(d).indexOf(e)+1,s=d.length;f(u,s)}else a.preventDefault(),console.log("Validation failed. Please fill in all required fields.")});let o=e.querySelector('[data-form="back-btn"]');Array.from(d).indexOf(e)===0?o&&(o.style.display="none"):o&&(o.style.display="flex"),o&&o.addEventListener("click",()=>{let a=e,l=a.previousElementSibling;l&&l.matches('[data-form="step"]')&&(a.style.display="none",l.style.display="flex");let r=Array.from(d).indexOf(l)+1,c=d.length;f(r,c)})});function T(e){e.preventDefault();let t=e.target.dataset.linkOut;window.location.href=t}document.querySelectorAll("[data-link-out]").forEach(e=>{e.dataset.linkOut&&e.addEventListener("click",T)});let W=document.getElementById("Income-Amount");function U(e){return e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}function Z(e){let t=e.target.value.replace(/,/g,""),n=U(t);e.target.value=n}W.addEventListener("input",Z);function j(e){return e=e.replace(/\D/g,""),e=e.substring(0,10),e.length>=6?e.replace(/(\d{3})(\d{3})(\d{1,4})/,"($1)-$2-$3"):e.length>=3?e.replace(/(\d{3})(\d{1,3})/,"($1)-$2"):e}function z(e){e.target.value=j(e.target.value)}document.querySelectorAll("[data-phone]").forEach(e=>{e.addEventListener("input",z)});function H(e){return e=e.replace(/\D/g,""),e.length>8&&(e=e.slice(0,8)),e.length>2&&(e=e.slice(0,2)+"-"+e.slice(2)),e.length>5&&(e=e.slice(0,5)+"-"+e.slice(5,9)),e}function Y(e){let t=H(e.target.value);e.target.value=t;let n=x(e.target),o=e.target.closest(".form-field_item").querySelector('[data-text="error-message"]');n?o.style.display="none":o.style.display="block"}document.getElementById("DOB").addEventListener("input",Y);let p=!1;Radar.initialize("prj_live_pk_9a04f6bab292b47ffdad877f7bd7d63fa6d2bc54");function G(){let e=document.getElementById("Street-Address"),t=document.getElementById("City"),n=document.getElementById("State-of-residence"),o=document.getElementById("ZIP-Code"),i=document.querySelector('[data-form="next-btn"]');document.getElementById("autocomplete-container")&&Radar.ui.autocomplete({container:"Street-Address",responsive:!0,minCharacters:2,debounceMS:0,onSelection:l=>{J(l,e,t,n,o),_(i),p=!0;let r=document.querySelector("radar-autocomplete-wrapper");r&&(r.style.display="none",console.log("Autocomplete container hidden")),e.dispatchEvent(new Event("focusout"))}})}function J(e,t,n,o,i){t.value="",n.value="",o.value="",i.value="",e.number&&e.street?t.value=`${e.number} ${e.street}`:t.value="",n.value=e.city||"",o.value=e.state||"",i.value=e.postalCode||"",i.dispatchEvent(new Event("input"))}G(),document.querySelectorAll("#Street-Address, #City, #State-of-residence, #ZIP-Code").forEach(e=>{e.addEventListener("input",()=>{p=!0})}),document.querySelectorAll(".form-next_btn").forEach(e=>{e.addEventListener("click",t=>{p||(t.preventDefault(),q(e))})})});})();
